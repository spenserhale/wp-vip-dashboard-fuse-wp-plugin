(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,n=window.React;var a=e.n(n);const r=window.wp.apiFetch;var s=e.n(r);const o=3e5,i=e=>{const t=Date.now()-Date.parse(e),n=Math.floor(t/6e4);if(n<1)return"less than a minute ago";if(n<60)return 1===n?"1 minute ago":`${n} minutes ago`;const a=Math.floor(n/60);if(a<24)return 1===a?"1 hour ago":`${a} hours ago`;const r=Math.floor(a/24);return 1===r?"1 day ago":`${r} days ago`},p=({config:e})=>{const[t,r]=(0,n.useState)(o),[p,d]=(0,n.useState)(null),l=()=>{s()(function(e){return{path:"/wvdf/v1/graphql/",method:"POST",data:{operationName:"GetAppDeployments",query:"\n    query GetAppDeployments($appId: Int!, $envId: Int, $first: Int) {\n      app(id: $appId) {\n        environments(id: $envId) {\n          deployments(first: $first) {\n            nodes {\n              inProgress\n              steps {\n                step\n                status\n                inProgress\n                startDate\n                finishDate\n              }\n            }\n          }\n        }\n      }\n    }\n  ",variables:{first:1,appId:parseInt(e.appId),envId:parseInt(e.envId)}}}}(e)).then((e=>{const t="string"==typeof e?JSON.parse(e):e,n=t?.data?.app?.environments?.[0]?.deployments?.nodes?.[0]||null;d(n),r(n?.inProgress?6e4:o)})).catch(console.error)};return(0,n.useEffect)(l,[]),(0,n.useEffect)((()=>{const e=setTimeout(l,t);return()=>clearTimeout(e)}),[t]),p?a().createElement(a().Fragment,null,a().createElement("div",{className:"ab-item ab-empty-item","aria-haspopup":"true"},a().createElement("span",{className:"ab-icon dashicons "+(p?.inProgress?"dashicons-update":"dashicons-editor-code")}),i(p?.inProgress?p.steps[0].startDate:p.steps[2].finishDate)),a().createElement("div",{className:"ab-sub-wrapper"},a().createElement("ul",{id:"wp-admin-bar-wp-vip-deployments-default",className:"ab-submenu"},p?.steps&&p.steps.map((e=>a().createElement("li",{id:"wp-admin-bar-wp-vip-deployments-"+e.step.toLowerCase(),key:e.step},a().createElement("a",{className:"ab-item"},(e=>{switch(e.step){case"PREPARE":return e.inProgress?"Preparing":"Prepared";case"BUILD":return e.inProgress?"Building":"Built";case"DEPLOYMENT":return e.inProgress?"Deploying":"Deployed";default:return"Unknown"}})(e)," ",e.inProgress?i(e.startDate):i(e.finishDate)))))))):null};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("wp-admin-bar-root-default");if(!e)return;if(!window.WpVipDashboardFuseLocalization)return;const n=window.WpVipDashboardFuseLocalization;if(!n.appId||!n.envId)return;const a=document.createElement("li");a.id="wp-admin-bar-wp-vip-deployment",a.className="menupop",e.appendChild(a),(0,t.render)(React.createElement(p,{config:n}),a)}))})();
//# sourceMappingURL=app.js.map