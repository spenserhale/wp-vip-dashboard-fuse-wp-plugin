{"version":3,"file":"app.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///external window [\"wp\",\"element\"]","webpack:///external window \"React\"","webpack:///external window [\"wp\",\"apiFetch\"]","webpack:///./react/DeploymentMenuItem.tsx","webpack:///./react/entry.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"element\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"React\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"apiFetch\"];","import React, {useEffect, useState} from 'react';\nimport apiFetch from '@wordpress/api-fetch';\nimport {Config} from \"./Definitions\";\n\n/**\n * Optimized objects for the API response\n */\ninterface Deployment {\n  inProgress: boolean;\n  steps: DeploymentStep[];\n}\n\ninterface DeploymentStep {\n  step: \"PREPARE\" | \"BUILD\" | \"DEPLOYMENT\";\n  inProgress: boolean;\n  startDate: string;\n  finishDate: string;\n}\n\nconst fiveMinutes = 300000;\nconst oneMinute = 60000;\n\nfunction getAppDeployment(config: Config) {\n  return {\n    path: '/wvdf/v1/graphql/',\n    method: 'POST',\n    data: {\n      operationName: 'GetAppDeployments',\n      query: `\n    query GetAppDeployments($appId: Int!, $envId: Int, $first: Int) {\n      app(id: $appId) {\n        environments(id: $envId) {\n          deployments(first: $first) {\n            nodes {\n              inProgress\n              steps {\n                step\n                status\n                inProgress\n                startDate\n                finishDate\n              }\n            }\n          }\n        }\n      }\n    }\n  `,\n      variables: {\n        first: 1,\n        appId: parseInt(config.appId),\n        envId: parseInt(config.envId),\n      }\n    }\n  }\n}\n\nconst stepDescription = (step: DeploymentStep) => {\n  switch (step.step) {\n    case \"PREPARE\":\n      return step.inProgress ? \"Preparing\" : \"Prepared\";\n    case \"BUILD\":\n      return step.inProgress ? \"Building\" : \"Built\";\n    case \"DEPLOYMENT\":\n      return step.inProgress ? \"Deploying\" : \"Deployed\";\n    default:\n      return \"Unknown\";\n  }\n}\n\nconst humanTimeDiff = (date: string) => {\n  const diff = Date.now() - Date.parse(date);\n  const minutes = Math.floor(diff / oneMinute);\n\n  if (minutes < 1) {\n    return \"less than a minute ago\";\n  } else if (minutes < 60) {\n    return minutes === 1 ? \"1 minute ago\" : `${minutes} minutes ago`;\n  }\n\n  const hours = Math.floor(minutes / 60);\n  if (hours < 24) {\n    return hours === 1 ? \"1 hour ago\" : `${hours} hours ago`;\n  }\n\n  const days = Math.floor(hours / 24);\n  return days === 1 ? \"1 day ago\" : `${days} days ago`;\n};\n\nconst DeploymentMenuItem = ({ config }: { config: Config }) => {\n  const [pollInterval, setPollInterval] = useState(fiveMinutes);\n  const [deployment, setDeployment] = useState<Deployment | null>(null);\n\n  const doFetch = () => {\n    apiFetch(getAppDeployment(config))\n      .then((value: unknown) => {\n        const json = typeof value === 'string' ? JSON.parse(value) : value;\n        const deployment = (json?.data?.app?.environments?.[0]?.deployments?.nodes?.[0]) as Deployment || null;\n        setDeployment(deployment);\n        setPollInterval(deployment?.inProgress ? oneMinute : fiveMinutes);\n      })\n      .catch(console.error);\n  }\n\n  useEffect(doFetch, []);\n\n  useEffect(() => {\n    const timeoutId = setTimeout(doFetch, pollInterval);\n    return () => clearTimeout(timeoutId);\n  }, [pollInterval]);\n\n  if (!deployment) {\n    return null;\n  }\n\n  return (<>\n    <div className=\"ab-item ab-empty-item\" aria-haspopup=\"true\">\n      <span className={\"ab-icon dashicons \" + (deployment?.inProgress ? \"dashicons-update\" : \"dashicons-editor-code\")}></span>\n      {deployment?.inProgress ? humanTimeDiff(deployment.steps[0].startDate) : humanTimeDiff(deployment.steps[2].finishDate)}\n    </div>\n    <div className=\"ab-sub-wrapper\">\n      <ul id=\"wp-admin-bar-wp-vip-deployments-default\" className=\"ab-submenu\">\n        {deployment?.steps && deployment.steps.map((step) => (\n          <li id={\"wp-admin-bar-wp-vip-deployments-\" + step.step.toLowerCase()} key={step.step}>\n              <a className=\"ab-item\">\n                {stepDescription(step)} {step.inProgress ? humanTimeDiff(step.startDate) : humanTimeDiff(step.finishDate)}\n              </a>\n          </li>\n        ))}\n      </ul>\n    </div>\n  </>);\n}\n\nexport default DeploymentMenuItem;\n","import { render } from \"@wordpress/element\";\nimport DeploymentMenuItem from \"./DeploymentMenuItem\";\nimport { Config } from \"./Definitions\";\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const adminBar = document.getElementById('wp-admin-bar-root-default');\n  if (!adminBar) {\n    return;\n  }\n\n  // @ts-ignore\n  if(!window.WpVipDashboardFuseLocalization) {\n    return;\n  }\n  // @ts-ignore\n  const config = window.WpVipDashboardFuseLocalization as Config;\n  if (!config.appId || !config.envId) {\n    return;\n  }\n\n  // add a new menu item to the admin bar\n  const menuItem = document.createElement('li');\n  menuItem.id = 'wp-admin-bar-wp-vip-deployment';\n  menuItem.className = 'menupop';\n  adminBar.appendChild(menuItem);\n\n  render(<DeploymentMenuItem config={config}/>, menuItem);\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","window","fiveMinutes","humanTimeDiff","date","diff","Date","now","parse","minutes","Math","floor","hours","days","DeploymentMenuItem","config","pollInterval","setPollInterval","useState","deployment","setDeployment","doFetch","apiFetch","path","method","data","operationName","query","variables","first","appId","parseInt","envId","getAppDeployment","then","value","json","JSON","app","environments","deployments","nodes","inProgress","catch","console","error","useEffect","timeoutId","setTimeout","clearTimeout","React","className","steps","startDate","finishDate","id","map","step","toLowerCase","stepDescription","document","addEventListener","adminBar","getElementById","WpVipDashboardFuseLocalization","menuItem","createElement","appendChild","render"],"sourceRoot":""}